#-------------------------------------------------------------------------
#  Notes for Setup_and_Config directory. 
#                                                          Mkuiper Jan 2012
#-------------------------------------------------------------------------

This directory contains scripts to help set up and manage jobs on a large cluster. 

Molecular dynamics simulations can take advantage of large cluster systems by 
launching either one large simulation or a large numer of smaller simulations
depending on the type of analysis required. 

These scripts are primarily designed to help set up multiple NAMD jobs on the 
BlueGene/Q but could be adapted for any program or system or used just for 
single simulations.  

The architecture is designed so as to run individual jobs under /MainJob_dir
in a directory structure based on /Setup_and_Config/JobTemplate 
 By editing the sims variable in the  "master_config_file" one can specify how 
many jobs instances to run  (from 1 to 999)

To create the job directories, simply run: 
./create_job_directories

This will create incrimented job directories copied from /JobTemplate as 
specified in "master_config_file" with the "BaseDirName" variable

Make sure to edit your optimization and production configuration files to point 
to your structure input files and parameter files.  
(We use "sim_opt.conf" and "sim_production.conf" as default files here) 

Before you go further, often it is a good idea to *benchmark* your simulation so 
you can get an idea of how well it runs on the system, and what optimal number of 
cores and configuration should be used.  Change into the /Benchmarking 
directory and follow the README there. 

Once you have chosen the numbers of cores to use and made the appropriate 
changes into the sbatch files make sure to populate your job directories
with your input files. Use:

./populate_config_files

( you can also use this script to make bulk updates to your job directories 
  on the fly) 

In the top main directory there are scripts to start, stop and monitor all 
simulations at once.  After you have created your directories and populated with 
your files, you are ready to submit the jobs.  We do this one directory up under 
the top directory. Change up to the top directory. To start your jobs use: 

./start_all_jobs.sh

If you need to stop all jobs use either: 

./stop_all_jobs_gently.sh

or 

./stop_all_jobs_immediately.sh

The first option is preferable and allows the job to finish its current block, 
which can be restarted at a later date.  The second will immedtiatley stop the 
job, but may leave untidy or corrupted data. 


